<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.stylefeng.guns.modular.form.mapper.WeighRecordMapper">
    <resultMap id="BaseResultMap" type="cn.stylefeng.guns.modular.form.entity.WeighRecord">
        <id column="id" property="id" jdbcType="INTEGER"/>

        <!-- 车牌号 -->
        <result column="plate_number" property="plateNumber" jdbcType="VARCHAR"/>

        <!-- 地磅编号 -->
        <result column="weighbridge_code" property="weighbridgeCode" jdbcType="VARCHAR"/>

        <!-- 皮重 -->
        <result column="tare" property="tare" jdbcType="DECIMAL"/>

        <!-- 毛重 -->
        <result column="gross" property="gross" jdbcType="DECIMAL"/>

        <!-- 称重时间 -->
        <result column="time_weigh" property="timeWeigh" jdbcType="TIMESTAMP"/>

        <!-- 备用 -->
        <result column="b1" property="b1" jdbcType="VARCHAR"/>

        <!-- 备用 -->
        <result column="b2" property="b2" jdbcType="VARCHAR"/>

        <!-- 备用 -->
        <result column="b3" property="b3" jdbcType="VARCHAR"/>

        <!-- 所属工区 -->
        <result column="work_area" property="workArea" jdbcType="VARCHAR"/>
    </resultMap>
    <sql id="Example_Where_Clause">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Apr 30 08:59:01 CST 2020.
        -->
        <where>
            <foreach collection="oredCriteria" item="criteria" separator="or">
                <if test="criteria.valid">
                    <trim prefix="(" suffix=")" prefixOverrides="and">
                        <foreach collection="criteria.criteria" item="criterion">
                            <choose>
                                <when test="criterion.noValue">
                                    and ${criterion.condition}
                                </when>
                                <when test="criterion.singleValue">
                                    and ${criterion.condition} #{criterion.value}
                                </when>
                                <when test="criterion.betweenValue">
                                    and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                                </when>
                                <when test="criterion.listValue">
                                    and ${criterion.condition}
                                    <foreach collection="criterion.value" item="listItem" open="(" close=")"
                                             separator=",">
                                        #{listItem}
                                    </foreach>
                                </when>
                            </choose>
                        </foreach>
                    </trim>
                </if>
            </foreach>
        </where>
    </sql>
    <sql id="Update_By_Example_Where_Clause">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Apr 30 08:59:01 CST 2020.
        -->
        <where>
            <foreach collection="example.oredCriteria" item="criteria" separator="or">
                <if test="criteria.valid">
                    <trim prefix="(" suffix=")" prefixOverrides="and">
                        <foreach collection="criteria.criteria" item="criterion">
                            <choose>
                                <when test="criterion.noValue">
                                    and ${criterion.condition}
                                </when>
                                <when test="criterion.singleValue">
                                    and ${criterion.condition} #{criterion.value}
                                </when>
                                <when test="criterion.betweenValue">
                                    and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                                </when>
                                <when test="criterion.listValue">
                                    and ${criterion.condition}
                                    <foreach collection="criterion.value" item="listItem" open="(" close=")"
                                             separator=",">
                                        #{listItem}
                                    </foreach>
                                </when>
                            </choose>
                        </foreach>
                    </trim>
                </if>
            </foreach>
        </where>
    </sql>
    <sql id="Base_Column_List">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Apr 30 08:59:01 CST 2020.
        -->
        id, plate_number, weighbridge_code, tare, gross, time_weigh, b1, b2, work_area
    </sql>
    <select id="selectByExample" resultMap="BaseResultMap"
            parameterType="cn.stylefeng.guns.modular.form.entity.WeighRecordExample">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Apr 30 08:59:01 CST 2020.
        -->
        select
        <if test="distinct">
            distinct
        </if>
        <include refid="Base_Column_List"/>
        from t_weigh_record
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
        <if test="orderByClause != null">
            order by ${orderByClause}
        </if>
    </select>
    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Apr 30 08:59:01 CST 2020.
        -->
        select
        <include refid="Base_Column_List"/>
        from t_weigh_record
        where id = #{id,jdbcType=INTEGER}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Apr 30 08:59:01 CST 2020.
        -->
        delete from t_weigh_record
        where id = #{id,jdbcType=INTEGER}
    </delete>
    <delete id="deleteByExample" parameterType="cn.stylefeng.guns.modular.form.entity.WeighRecordExample">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Apr 30 08:59:01 CST 2020.
        -->
        delete from t_weigh_record
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
    </delete>
    <insert id="insert">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Apr 30 08:59:01 CST 2020.
        -->
        insert into t_weigh_record (id, plate_number, weighbridge_code,
        tare, gross, time_weigh,
        b1, b2, b3, work_area
        )
        values (#{id,jdbcType=INTEGER}, #{plateNumber,jdbcType=VARCHAR}, #{weighbridgeCode,jdbcType=VARCHAR},
        #{tare,jdbcType=DECIMAL}, #{gross,jdbcType=DECIMAL}, #{timeWeigh,jdbcType=TIMESTAMP},
        #{b1,jdbcType=VARCHAR}, #{b2,jdbcType=VARCHAR}, #{b3,jdbcType=VARCHAR}, #{workArea,jdbcType=VARCHAR}
        )
    </insert>
    <insert id="insertSelective">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Apr 30 08:59:01 CST 2020.
        -->
        insert into t_weigh_record
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="plateNumber != null">
                plate_number,
            </if>
            <if test="weighbridgeCode != null">
                weighbridge_code,
            </if>
            <if test="tare != null">
                tare,
            </if>
            <if test="gross != null">
                gross,
            </if>
            <if test="timeWeigh != null">
                time_weigh,
            </if>
            <if test="b1 != null">
                b1,
            </if>
            <if test="b2 != null">
                b2,
            </if>
            <if test="b3 != null">
                b3,
            </if>
            <if test="workArea != null">
                work_area,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=INTEGER},
            </if>
            <if test="plateNumber != null">
                #{plateNumber,jdbcType=VARCHAR},
            </if>
            <if test="weighbridgeCode != null">
                #{weighbridgeCode,jdbcType=VARCHAR},
            </if>
            <if test="tare != null">
                #{tare,jdbcType=DECIMAL},
            </if>
            <if test="gross != null">
                #{gross,jdbcType=DECIMAL},
            </if>
            <if test="timeWeigh != null">
                #{timeWeigh,jdbcType=TIMESTAMP},
            </if>
            <if test="b1 != null">
                #{b1,jdbcType=VARCHAR},
            </if>
            <if test="b2 != null">
                #{b2,jdbcType=VARCHAR},
            </if>
            <if test="b3 != null">
                #{b3,jdbcType=VARCHAR},
            </if>
            <if test="workArea != null">
                #{workArea,jdbcType=VARCHAR},
            </if>
        </trim>
    </insert>
    <select id="countByExample" parameterType="cn.stylefeng.guns.modular.form.entity.WeighRecordExample"
            resultType="java.lang.Integer">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Apr 30 08:59:01 CST 2020.
        -->
        select count(*) from t_weigh_record
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
    </select>
    <update id="updateByExampleSelective" parameterType="map">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Apr 30 08:59:01 CST 2020.
        -->
        update t_weigh_record
        <set>
            <if test="record.id != null">
                id = #{record.id,jdbcType=INTEGER},
            </if>
            <if test="record.plateNumber != null">
                plate_number = #{record.plateNumber,jdbcType=VARCHAR},
            </if>
            <if test="record.weighbridgeCode != null">
                weighbridge_code = #{record.weighbridgeCode,jdbcType=VARCHAR},
            </if>
            <if test="record.tare != null">
                tare = #{record.tare,jdbcType=DECIMAL},
            </if>
            <if test="record.gross != null">
                gross = #{record.gross,jdbcType=DECIMAL},
            </if>
            <if test="record.timeWeigh != null">
                time_weigh = #{record.timeWeigh,jdbcType=TIMESTAMP},
            </if>
            <if test="record.b1 != null">
                b1 = #{record.b1,jdbcType=VARCHAR},
            </if>
            <if test="record.b2 != null">
                b2 = #{record.b2,jdbcType=VARCHAR},
            </if>
            <if test="record.b3 != null">
                b3 = #{record.b3,jdbcType=VARCHAR},
            </if>
            <if test="record.workArea != null">
                work_area = #{record.workArea,jdbcType=VARCHAR},
            </if>
        </set>
        <if test="_parameter != null">
            <include refid="Update_By_Example_Where_Clause"/>
        </if>
    </update>
    <update id="updateByExample" parameterType="map">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Apr 30 08:59:01 CST 2020.
        -->
        update t_weigh_record
        set id = #{record.id,jdbcType=INTEGER},
        plate_number = #{record.plateNumber,jdbcType=VARCHAR},
        weighbridge_code = #{record.weighbridgeCode,jdbcType=VARCHAR},
        tare = #{record.tare,jdbcType=DECIMAL},
        gross = #{record.gross,jdbcType=DECIMAL},
        time_weigh = #{record.timeWeigh,jdbcType=TIMESTAMP},
        b1 = #{record.b1,jdbcType=VARCHAR},
        b2 = #{record.b2,jdbcType=VARCHAR},
        b3 = #{record.b3,jdbcType=VARCHAR},
        work_area = #{record.workArea,jdbcType=VARCHAR}
        <if test="_parameter != null">
            <include refid="Update_By_Example_Where_Clause"/>
        </if>
    </update>
    <update id="updateByPrimaryKeySelective">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Apr 30 08:59:01 CST 2020.
        -->
        update t_weigh_record
        <set>
            <if test="plateNumber != null">
                plate_number = #{plateNumber,jdbcType=VARCHAR},
            </if>
            <if test="weighbridgeCode != null">
                weighbridge_code = #{weighbridgeCode,jdbcType=VARCHAR},
            </if>
            <if test="tare != null">
                tare = #{tare,jdbcType=DECIMAL},
            </if>
            <if test="gross != null">
                gross = #{gross,jdbcType=DECIMAL},
            </if>
            <if test="timeWeigh != null">
                time_weigh = #{timeWeigh,jdbcType=TIMESTAMP},
            </if>
            <if test="b1 != null">
                b1 = #{b1,jdbcType=VARCHAR},
            </if>
            <if test="b2 != null">
                b2 = #{b2,jdbcType=VARCHAR},
            </if>
            <if test="b3 != null">
                b3 = #{b3,jdbcType=VARCHAR},
            </if>
            <if test="workArea != null">
                work_area = #{workArea,jdbcType=VARCHAR},
            </if>
        </set>
        where id = #{id,jdbcType=INTEGER}
    </update>
    <update id="updateByPrimaryKey">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Apr 30 08:59:01 CST 2020.
        -->
        update t_weigh_record
        set plate_number = #{plateNumber,jdbcType=VARCHAR},
        weighbridge_code = #{weighbridgeCode,jdbcType=VARCHAR},
        tare = #{tare,jdbcType=DECIMAL},
        gross = #{gross,jdbcType=DECIMAL},
        time_weigh = #{timeWeigh,jdbcType=TIMESTAMP},
        b1 = #{b1,jdbcType=VARCHAR},
        b2 = #{b2,jdbcType=VARCHAR},
        b3 = #{b3,jdbcType=VARCHAR},
        work_area = #{workArea,jdbcType=VARCHAR}
        where id = #{id,jdbcType=INTEGER}
    </update>
    <select resultMap="BaseResultMap" parameterType="cn.stylefeng.guns.modular.form.entity.WeighRecordExample"
            id="selectByExampleWithRowbounds">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Apr 30 08:59:01 CST 2020.
        -->
        select
        <if test="distinct">
            distinct
        </if>
        <include refid="Base_Column_List"/>
        from t_weigh_record
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
        <if test="orderByClause != null">
            order by ${orderByClause}
        </if>
    </select>

    <!-- ### 以上代码由MBG + CommentPlugin自动生成, 生成时间: 2020-04-30 08:59:01 ### -->


    <!-- Your codes goes here!!! -->

    <select id="queryWeighRecord" resultType="map">
        select
        <include refid="Base_Column_List"/>
        FROM
        t_weigh_record
        where 1=1
        <if test="condition != null">
            and plate_number like CONCAT('%', #{condition,jdbcType=VARCHAR}, '%')
        </if>
    </select>

    <select id="getReportByMonth" resultType="cn.stylefeng.guns.modular.form.entity.xlsx.XlsxDataBean">
        SELECT
        IFNULL(COUNT(plate_number), 0) AS vehiclenumber,
        IFNULL(SUM(tare), 0) AS tare,
        IFNULL(SUM(gross), 0) AS gross,
        DATE_FORMAT(time_weigh, '%Y-%m-%d') AS show_time,
        weighbridge_code weighbridgeCode
        FROM
        t_weigh_record
        WHERE 1 = 1
        <if test="startTime != null and endTime != null">
            and time_weigh between #{startTime} and #{endTime}
        </if>
        <if test="areaCode != null">
            and work_area = #{areaCode}
        </if>
        GROUP BY
        show_time,
        weighbridge_code
        ORDER BY
        show_time ASC
    </select>

    <select id="getReportBySeason" resultType="cn.stylefeng.guns.modular.form.entity.xlsx.XlsxDataBean">
        SELECT
        IFNULL(COUNT(plate_number), 0) AS vehiclenumber,
        IFNULL(SUM(tare), 0) AS tare,
        IFNULL(SUM(gross), 0) AS gross,
        month(time_weigh) as months,
        weighbridge_code weighbridgeCode
        FROM
        t_weigh_record
        WHERE 1 = 1
        <if test="date != null">
            and QUARTER(time_weigh) = #{date}
            and year(time_weigh)=year(now())
        </if>
        <if test="areaCode != null">
            and work_area = #{areaCode}
        </if>
        GROUP BY
        months,
        weighbridgeCode
        ORDER BY
        months ASC
    </select>

    <select id="getReportByHalf" resultType="cn.stylefeng.guns.modular.form.entity.xlsx.XlsxDataBean">
        SELECT
        IFNULL(COUNT(plate_number), 0) AS vehiclenumber,
        IFNULL(SUM(tare), 0) AS tare,
        IFNULL(SUM(gross), 0) AS gross,
        month(time_weigh) as months,
        weighbridge_code AS weighbridgeCode
        FROM
        t_weigh_record
        WHERE 1 = 1
        and year(time_weigh)=year(now())
        <if test="areaCode != null">
            and work_area = #{areaCode}
        </if>
        GROUP BY
        months,
        weighbridge_code
        <choose>
            <when test='date != null and date == "1"'>
                HAVING
                <![CDATA[
            months <= 6
            ]]>
            </when>
            <otherwise>
                HAVING
                <![CDATA[
            months >= 7
            ]]>
            </otherwise>
        </choose>
        ORDER BY
        months ASC
    </select>

    <select id="getReportByYear" resultType="cn.stylefeng.guns.modular.form.entity.xlsx.XlsxDataBean">
        SELECT
        IFNULL(COUNT(plate_number), 0) AS vehiclenumber,
        IFNULL(SUM(tare), 0) AS tare,
        IFNULL(SUM(gross), 0) AS gross,
        month(time_weigh) as months,
        weighbridge_code AS weighbridgeCode
        FROM
        t_weigh_record
        WHERE 1 = 1
        <if test="date != null">
            and year(time_weigh)=year(#{date})
        </if>
        <if test="areaCode != null">
            and work_area = #{areaCode}
        </if>
        GROUP BY
        months,
        weighbridge_code
        ORDER BY
        months ASC
    </select>

    <select id="getSixReportByDay" resultMap="BaseResultMap">
        SELECT
        plate_number,
        tare,
        gross,
        work_area
        FROM
        t_weigh_record
        WHERE 1 = 1
        <if test="poundNumber != null">
            and weighbridge_code = #{poundNumber}
        </if>
        <if test="startTime != null and endTime != null">
            and time_weigh BETWEEN #{startTime} AND #{endTime}
        </if>
        ORDER BY
        time_weigh ASC
    </select>
    <select id="getSixReportByMonth" resultType="cn.stylefeng.guns.modular.form.entity.xlsx.XlsxDataBean">
        SELECT
        IFNULL(COUNT(plate_number), 0) AS vehiclenumber,
        IFNULL(SUM(tare), 0) AS tare,
        IFNULL(SUM(gross), 0) AS gross,
        DATE_FORMAT(time_weigh, '%Y-%m-%d') AS showTime,
        work_area as workArea
        FROM
        t_weigh_record
        WHERE 1 = 1
        <if test="poundNumber != null">
            and weighbridge_code = #{poundNumber}
        </if>
        <if test="startTime != null and endTime != null">
            and time_weigh between #{startTime} and #{endTime}
        </if>
        GROUP BY
        showTime,
        work_area
        ORDER BY
        showTime ASC
    </select>
    <select id="getSixReportBySeason" resultType="cn.stylefeng.guns.modular.form.entity.xlsx.XlsxDataBean">
        SELECT
        IFNULL(COUNT(plate_number), 0) AS vehiclenumber,
        IFNULL(SUM(tare), 0) AS tare,
        IFNULL(SUM(gross), 0) AS gross,
        month(time_weigh) as months,
        work_area as workArea
        FROM
        t_weigh_record
        WHERE 1 = 1
        <if test="poundNumber != null">
            and weighbridge_code = #{poundNumber}
        </if>
        <if test="date != null">
            and QUARTER(time_weigh) = #{date}
            and year(time_weigh)=year(now())
        </if>
        GROUP BY
        months,
        work_area
        ORDER BY
        months ASC
    </select>
    <select id="getSixReportByHalf" resultType="cn.stylefeng.guns.modular.form.entity.xlsx.XlsxDataBean">
        SELECT
        IFNULL(COUNT(plate_number), 0) AS vehiclenumber,
        IFNULL(SUM(tare), 0) AS tare,
        IFNULL(SUM(gross), 0) AS gross,
        month(time_weigh) as months,
        work_area as workArea
        FROM
        t_weigh_record
        WHERE 1 = 1
        <if test="poundNumber != null">
            and weighbridge_code = #{poundNumber}
            and year(time_weigh)=year(now())
        </if>
        GROUP BY
        months,
        work_area
        <choose>
            <when test='date != null and date == "1"'>
                HAVING
                <![CDATA[
            months <= 6
            ]]>
            </when>
            <otherwise>
                HAVING
                <![CDATA[
            months >= 7
            ]]>
            </otherwise>
        </choose>
        ORDER BY
        months ASC
    </select>
    <select id="getSixReportByYear" resultType="cn.stylefeng.guns.modular.form.entity.xlsx.XlsxDataBean">
        SELECT
        IFNULL(COUNT(plate_number), 0) AS vehiclenumber,
        IFNULL(SUM(tare), 0) AS tare,
        IFNULL(SUM(gross), 0) AS gross,
        month(time_weigh) as months,
        work_area as workArea
        FROM
        t_weigh_record
        WHERE 1 = 1
        <if test="poundNumber != null">
            and weighbridge_code = #{poundNumber}
        </if>
        <if test="date != null">
            and year(time_weigh) = #{date}
        </if>
        GROUP BY
        months,
        work_area
        ORDER BY
        months ASC
    </select>

    <select id="queryListByCondition" resultType="map">
        select
        <include refid="Base_Column_List"/>
        FROM
        t_weigh_record
        where 1=1
        <if test="beginTime != null and beginTime != '' and endTime != null and endTime != ''">
            and DATE_FORMAT(time_weigh,'%Y-%m-%d %H:%i:%s') between #{beginTime} and #{endTime}
        </if>
        <if test="day != null and day != ''">
            and DATE_FORMAT(time_weigh,'%Y-%m-%d') = #{day}
        </if>
        <if test="month != null and month != ''">
            and DATE_FORMAT(time_weigh,'%Y-%m') = #{month}
        </if>
        <if test="season != null and season != ''">
            and QUARTER(time_weigh) = #{season}
            and year(time_weigh)=year(now())
        </if>
        <if test="half != null and half != ''">
            <choose>
                <when test='half != null and half == "1"'>
                    and
                    <![CDATA[
            month(time_weigh) <= 6
            ]]>
                </when>
                <otherwise>
                    and
                    <![CDATA[
            month(time_weigh) >= 7
            ]]>
                </otherwise>
            </choose>
        </if>
        <if test="year != null and year != ''">
            and year(time_weigh) = #{year}
        </if>
        <if test="areaCode != null and areaCode != ''">
            and work_area = #{areaCode}
        </if>
        <if test="poundNumber != null and poundNumber != ''">
            and weighbridge_code = #{poundNumber}
        </if>
        <if test="plateNumber != null and plateNumber != ''">
            and plate_number = #{plateNumber}
        </if>
    </select>


    <!-- 查询最近时间的一条数据 -->
    <select id="queryWeighRecordByLicense" parameterType="string" resultType="cn.stylefeng.guns.modular.form.entity.WeighRecord">
        select
        <include refid="Base_Column_List" />
        FROM
        t_weigh_record
        where 1=1
        <if test="license != null and license != ''">
            and plate_number = #{license}
        </if>
        ORDER BY time_weigh DESC
        LIMIT 1
    </select>


</mapper>